{
  "hash": "55fe9603f71830193cb1f951e2d19c75",
  "result": {
    "engine": "jupyter",
    "markdown": "---\ntitle: \"Poisson Regression Examples\"\nauthor: \"Bansari Kathrotia\"\ndate: today\ncallout-appearance: minimal # this hides the blue \"i\" icon on .callout-notes\neditor_options: \n  chunk_output_type: console\n---\n\nThis assignment uses the MNL model to analyze (1) yogurt purchase data made by consumers at a retail location, and (2) conjoint data about consumer preferences for minivans.\n\n\n## 1. Estimating Yogurt Preferences\n\n### Likelihood for the Multi-nomial Logit (MNL) Model\n\nSuppose we have $i=1,\\ldots,n$ consumers who each select exactly one product $j$ from a set of $J$ products. The outcome variable is the identity of the product chosen $y_i \\in \\{1, \\ldots, J\\}$ or equivalently a vector of $J-1$ zeros and $1$ one, where the $1$ indicates the selected product. For example, if the third product was chosen out of 4 products, then either $y=3$ or $y=(0,0,1,0)$ depending on how we want to represent it. Suppose also that we have a vector of data on each product $x_j$ (eg, size, price, etc.). \n\nWe model the consumer's decision as the selection of the product that provides the most utility, and we'll specify the utility function as a linear function of the product characteristics:\n\n$$ U_{ij} = x_j'\\beta + \\epsilon_{ij} $$\n\nwhere $\\epsilon_{ij}$ is an i.i.d. extreme value error term. \n\nThe choice of the i.i.d. extreme value error term leads to a closed-form expression for the probability that consumer $i$ chooses product $j$:\n\n$$ \\mathbb{P}_i(j) = \\frac{e^{x_j'\\beta}}{\\sum_{k=1}^Je^{x_k'\\beta}} $$\n\nFor example, if there are 4 products, the probability that consumer $i$ chooses product 3 is:\n\n$$ \\mathbb{P}_i(3) = \\frac{e^{x_3'\\beta}}{e^{x_1'\\beta} + e^{x_2'\\beta} + e^{x_3'\\beta} + e^{x_4'\\beta}} $$\n\nA clever way to write the individual likelihood function for consumer $i$ is the product of the $J$ probabilities, each raised to the power of an indicator variable ($\\delta_{ij}$) that indicates the chosen product:\n\n$$ L_i(\\beta) = \\prod_{j=1}^J \\mathbb{P}_i(j)^{\\delta_{ij}} = \\mathbb{P}_i(1)^{\\delta_{i1}} \\times \\ldots \\times \\mathbb{P}_i(J)^{\\delta_{iJ}}$$\n\nNotice that if the consumer selected product $j=3$, then $\\delta_{i3}=1$ while $\\delta_{i1}=\\delta_{i2}=\\delta_{i4}=0$ and the likelihood is:\n\n$$ L_i(\\beta) = \\mathbb{P}_i(1)^0 \\times \\mathbb{P}_i(2)^0 \\times \\mathbb{P}_i(3)^1 \\times \\mathbb{P}_i(4)^0 = \\mathbb{P}_i(3) = \\frac{e^{x_3'\\beta}}{\\sum_{k=1}^Je^{x_k'\\beta}} $$\n\nThe joint likelihood (across all consumers) is the product of the $n$ individual likelihoods:\n\n$$ L_n(\\beta) = \\prod_{i=1}^n L_i(\\beta) = \\prod_{i=1}^n \\prod_{j=1}^J \\mathbb{P}_i(j)^{\\delta_{ij}} $$\n\nAnd the joint log-likelihood function is:\n\n$$ \\ell_n(\\beta) = \\sum_{i=1}^n \\sum_{j=1}^J \\delta_{ij} \\log(\\mathbb{P}_i(j)) $$\n\n\n### Yogurt Dataset\n\nWe will use the `yogurt_data` dataset, which provides anonymized consumer identifiers (`id`), a vector indicating the chosen product (`y1`:`y4`), a vector indicating if any products were \"featured\" in the store as a form of advertising (`f1`:`f4`), and the products' prices (`p1`:`p4`). For example, consumer 1 purchased yogurt 4 at a price of 0.079/oz and none of the yogurts were featured/advertised at the time of consumer 1's purchase.  Consumers 2 through 7 each bought yogurt 2, etc.\n\n_todo: import the data, maybe show the first few rows, and describe the data a bit._\n\n\n\n::: {#99949691 .cell message='true' execution_count=2}\n\n::: {.cell-output .cell-output-display execution_count=2}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>y1</th>\n      <th>y2</th>\n      <th>y3</th>\n      <th>y4</th>\n      <th>f1</th>\n      <th>f2</th>\n      <th>f3</th>\n      <th>f4</th>\n      <th>p1</th>\n      <th>p2</th>\n      <th>p3</th>\n      <th>p4</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.108</td>\n      <td>0.081</td>\n      <td>0.061</td>\n      <td>0.079</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.108</td>\n      <td>0.098</td>\n      <td>0.064</td>\n      <td>0.075</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>3</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.108</td>\n      <td>0.098</td>\n      <td>0.061</td>\n      <td>0.086</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>4</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.108</td>\n      <td>0.098</td>\n      <td>0.061</td>\n      <td>0.086</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>5</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.125</td>\n      <td>0.098</td>\n      <td>0.049</td>\n      <td>0.079</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>2425</th>\n      <td>2426</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.122</td>\n      <td>0.086</td>\n      <td>0.061</td>\n      <td>0.086</td>\n    </tr>\n    <tr>\n      <th>2426</th>\n      <td>2427</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.122</td>\n      <td>0.086</td>\n      <td>0.061</td>\n      <td>0.086</td>\n    </tr>\n    <tr>\n      <th>2427</th>\n      <td>2428</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.122</td>\n      <td>0.086</td>\n      <td>0.061</td>\n      <td>0.086</td>\n    </tr>\n    <tr>\n      <th>2428</th>\n      <td>2429</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.122</td>\n      <td>0.086</td>\n      <td>0.050</td>\n      <td>0.086</td>\n    </tr>\n    <tr>\n      <th>2429</th>\n      <td>2430</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.108</td>\n      <td>0.086</td>\n      <td>0.043</td>\n      <td>0.079</td>\n    </tr>\n  </tbody>\n</table>\n<p>2430 rows Ã— 13 columns</p>\n</div>\n```\n:::\n:::\n\n\nThe dataset contains the following columns:\n\n*   `id`: Unique identifier for each consumer.\n*   `y1` to `y4`: Binary indicators showing which of the four yogurts was chosen by the consumer. Only one of these columns will have a value of `1` per row, indicating the chosen product.\n*   `f1` to `f4`: Binary indicators showing whether each of the four yogurts was featured (advertised) in the store at the time of the purchase.\n*   `p1` to `p4`: Numeric values representing the price per ounce of each of the four yogurts.\n\nFrom the preview of the data:\n\n*   In the first row, consumer with `id` 1 purchased yogurt 4 (as indicated by `y4` = 1) at a price of 0.079 per ounce. None of the yogurts were featured.\n*   Subsequent rows show similar data for other consumers, indicating their choices and the conditions (price and whether the product was featured) under each product.\n\n\nLet the vector of product features include brand dummy variables for yogurts 1-3 (we'll omit a dummy for product 4 to avoid multi-collinearity), a dummy variable to indicate if a yogurt was featured, and a continuous variable for the yogurts' prices:  \n\n$$ x_j' = [\\mathbbm{1}(\\text{Yogurt 1}), \\mathbbm{1}(\\text{Yogurt 2}), \\mathbbm{1}(\\text{Yogurt 3}), X_f, X_p] $$\n\nThe \"hard part\" of the MNL likelihood function is organizing the data, as we need to keep track of 3 dimensions (consumer $i$, covariate $k$, and product $j$) instead of the typical 2 dimensions for cross-sectional regression models (consumer $i$ and covariate $k$). \n\nWhat we would like to do is reorganize the data from a \"wide\" shape with $n$ rows and multiple columns for each covariate, to a \"long\" shape with $n \\times J$ rows and a single column for each covariate.  As part of this re-organization, we'll add binary variables to indicate the first 3 products; the variables for featured and price are included in the dataset and simply need to be \"pivoted\" or \"melted\" from wide to long.  \n\n_todo: reshape and prep the data_\n\n\n\n\n\n::: {#e0108313 .cell message='true' execution_count=5}\n\n::: {.cell-output .cell-output-display execution_count=5}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>id</th>\n      <th>choice</th>\n      <th>featured</th>\n      <th>price</th>\n      <th>product</th>\n      <th>brand1</th>\n      <th>brand2</th>\n      <th>brand3</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.108</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.108</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>3</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.108</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>4</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.108</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>5</td>\n      <td>0</td>\n      <td>0</td>\n      <td>0.125</td>\n      <td>1</td>\n      <td>1</td>\n      <td>0</td>\n      <td>0</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\nThe dataset has been reshaped into the long format using the dataset named \"yogurt\". Here is the structure of the transformed data:\n\n*   `id`: Consumer identifier.\n*   `choice`: Indicates whether the consumer chose this product (1 if chosen, 0 otherwise).\n*   `featured`: Indicates whether the product was featured (1 if featured, 0 otherwise).\n*   `price`: Price per ounce of the product.\n*   `product`: Product number (1 through 4).\n*   `brand1`, `brand2`, `brand3`: Dummy variables for the first three products, with the fourth product omitted to avoid multicollinearity.\n\n\n### Estimation\n\n_todo: Code up the log-likelihood function._\n\n1.  **Utility Function**: Calculates the utility for each product based on the beta coefficients and the features in the dataset.\n2.  **Probability Calculation**: Determines the probabilities of choosing each product by a consumer, factoring in the utilities of all available products for normalization.\n3.  **Log-Likelihood**: Computes the log of these probabilities where the product was actually chosen (where `choice == 1`) and sums these values to obtain the log-likelihood for the dataset given the model parameters.\n\n::: {#85fb219a .cell message='true' execution_count=6}\n\n::: {.cell-output .cell-output-stdout}\n```\nLog-Likelihood Value: -3570.660714305375\n```\n:::\n:::\n\n\n_todo: Use `optim()` in R or `optimize()` in Python to find the MLEs for the 5 parameters ($\\beta_1, \\beta_2, \\beta_3, \\beta_f, \\beta_p$).  (Hint: you should find 2 positive and 1 negative product intercepts, a small positive coefficient estimate for featured, and a large negative coefficient estimate for price.)_\n\n\n\n::: {#4181b04a .cell message='true' execution_count=8}\n``` {.python .cell-code}\n# Optimization to find the MLE of the beta coefficients\nresult = minimize(negative_log_likelihood, initial_beta, args=(long_data_final,), \n                  method='L-BFGS-B', bounds=bounds)\n\n# Print the optimization results\nprint(\"Optimization Success:\", result.success)\nprint(\"Estimated beta coefficients:\", result.x)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOptimization Success: True\nEstimated beta coefficients: [  1.38775685   0.64350552  -3.08612138   0.48740703 -37.05803459]\n```\n:::\n:::\n\n\n### Discussion\n\nWe learn...\n\n_todo: interpret the 3 product intercepts (which yogurt is most preferred?)._\n\nInterpreting the three product intercepts from the estimated beta coefficients for Brands 1, 2, and 3, we can gauge consumer preferences among the yogurt options relative to the baseline (Brand 4, which does not have a specific intercept and is implied as zero in the model). Hereâ€™s how to interpret the intercepts:\n\n1.  **Beta for Brand 1 (`beta_1`)**: 1.388\n    \n    *   This positive intercept suggests that, holding other factors constant (such as price and whether the product was featured), Brand 1 is preferred over Brand 4. The higher positive value indicates a strong preference for this brand.\n2.  **Beta for Brand 2 (`beta_2`)**: 0.644\n    \n    *   Similarly, this positive intercept indicates a preference for Brand 2 over Brand 4, though the preference is less strong compared to Brand 1. Brand 2 is still preferred but not as much as Brand 1.\n3.  **Beta for Brand 3 (`beta_3`)**: âˆ’3.086\n    \n    *   The negative value of this intercept indicates that Brand 3 is less preferred compared to Brand 4. This substantial negative value suggests a strong aversion to Brand 3 relative to the other options.\n\n### Which yogurt is most preferred?\n\nBased on the magnitude and direction of the beta coefficients:\n\n*   **Brand 1** is the most preferred yogurt among the options. It has the highest positive intercept, indicating the strongest preference relative to the baseline (Brand 4).\n*   **Brand 2** is also preferred over the baseline but to a lesser extent than Brand 1.\n*   **Brand 3** is the least preferred, with a significant negative intercept indicating a strong preference against it compared to Brand 4.\n\nThis interpretation can help in strategic decisions related to marketing and product placement, such as focusing promotional efforts on Brands 1 and 2, considering price adjustments or rebranding for Brand 3, and understanding the competitive position of Brand 4 as a potentially neutral or fallback option.\n\n\n_todo: use the estimated price coefficient as a dollar-per-util conversion factor. Use this conversion factor to calculate the dollar benefit between the most-preferred yogurt (the one with the highest intercept) and the least preferred yogurt (the one with the lowest intercept). This is a per-unit monetary measure of brand value._\n\n*   **Identify the most and least preferred yogurts**:\n    \n    *   Most preferred: Brand 1 (intercept = 1.388)\n    *   Least preferred: Brand 3 (intercept = -3.086)\n*   **Calculate the difference in utilities** between the most preferred and least preferred yogurts:\n    \n*   **Use the price coefficient as a conversion factor**:\n    \n    *   Price coefficient (`beta_p`): âˆ’37.058\n    *   The price coefficient's magnitude indicates the decrease in the utility of purchasing a yogurt per dollar increase in its price. Therefore, it acts as a conversion factor from utility to dollar value.\n\n\n\n::: {#4472174b .cell message='true' execution_count=10}\n``` {.python .cell-code}\n# Calculate the dollar benefit\ndollar_benefit = utility_difference * dollar_value_per_util\ndollar_benefit\n```\n\n::: {.cell-output .cell-output-display execution_count=10}\n```\n-0.12072966700847321\n```\n:::\n:::\n\n\nThe calculated dollar benefit between the most preferred yogurt (Brand 1) and the least preferred yogurt (Brand 3) is approximately \\-$0.121 per unit. This indicates that consumers might be willing to pay about 12 cents more per unit for Brand 1 over Brand 3 due to their difference in utility, based on the model estimates.\n\nThis negative sign might initially seem counterintuitive, but it reflects how much less consumers would be willing to pay for the less preferred option (Brand 3). In other words, Brand 1 has a higher inherent value of about 12 cents per unit over Brand 3 in the eyes of consumers.\n\nThis monetary measure effectively quantifies the brand value in dollar terms based on consumer preferences modeled by the MNL. This insight can be leveraged for pricing strategies and marketing efforts to enhance product positioning and profitability.\n\nOne benefit of the MNL model is that we can simulate counterfactuals (eg, what if the price of yogurt 1 was $0.10/oz instead of $0.08/oz).\n\n_todo: calculate the market shares in the market at the time the data were collected.  Then, increase the price of yogurt 1 by $0.10 and use your fitted model to predict p(y|x) for each consumer and each product (this should be a matrix of $N \\times 4$ estimated choice probabilities.  Take the column averages to get the new, expected market shares that result from the $0.10 price increase to yogurt 1.  Do the yogurt 1 market shares decrease?_\n\nTo calculate the market shares and predict the changes in market share due to a price increase for Yogurt 1,\n\n*   **Calculate Current Market Shares**:\n    \n    *   Count the number of times each product was chosen and divide by the total number of observations.\n*   **Simulate the Effect of a Price Increase for Yogurt 1**:\n    \n    *   Increase the price of Yogurt 1 by $0.10 and use the fitted model to estimate the choice probabilities for each product and each consumer.\n    *   Calculate the expected market shares by taking the average of the choice probabilities across all consumers for each product.\n\n::: {#3908e28f .cell message='true' execution_count=11}\n``` {.python .cell-code}\n# Calculate the current market shares\ncurrent_market_shares = long_data_final.groupby('product')['choice'].mean()\nprint(\"Current Market Shares:\", current_market_shares)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nCurrent Market Shares: product\n1    0.341975\n2    0.401235\n3    0.029218\n4    0.227572\nName: choice, dtype: float64\n```\n:::\n:::\n\n\n\n\n::: {#e3dce205 .cell message='true' execution_count=13}\n``` {.python .cell-code}\n# Call the function with the original data and fitted beta coefficients\nnew_market_shares = predict_new_market_shares(long_data_final, result.x)\nprint(\"New Market Shares After Price Increase:\", new_market_shares)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nNew Market Shares After Price Increase: product\n1    0.021118\n2    0.591145\n3    0.044040\n4    0.343697\nName: probability, dtype: float64\n```\n:::\n:::\n\n\nBased on the results provided:\n\n### Current Market Shares:\n\n*   **Yogurt 1**: 34.2%\n*   **Yogurt 2**: 40.1%\n*   **Yogurt 3**: 2.9%\n*   **Yogurt 4**: 22.8%\n\n### New Market Shares After a $0.10 Price Increase to Yogurt 1:\n\n*   **Yogurt 1**: 2.1%\n*   **Yogurt 2**: 59.1%\n*   **Yogurt 3**: 4.4%\n*   **Yogurt 4**: 34.4%\n\n### Analysis:\n\n*   **Yogurt 1 Market Share**: The market share for Yogurt 1 drastically decreases from 34.2% to 2.1%. This significant reduction clearly indicates that the price sensitivity for Yogurt 1 is quite high, and even a modest price increase leads to a substantial shift in consumer preferences away from this product.\n*   **Shifts to Other Products**: The market shares of Yogurt 2, 3, and 4 all increase. Yogurt 2 benefits the most, with its market share increasing by nearly 19 percentage points. This suggests that consumers consider Yogurt 2 a close substitute for Yogurt 1, switching to it when Yogurt 1 becomes more expensive.\n*   **Yogurt 3 and 4**: Even though Yogurt 3 had a very low initial market share, it sees a relative increase, suggesting some consumers might switch to lower preference options if their first choice becomes less economically viable. Yogurt 4 also sees a notable increase in market share.\n\n### Conclusion:\n\nThe $0.10 price increase for Yogurt 1 drastically reduces its market share, confirming the price sensitivity and showing a clear preference shift among consumers to other available options, particularly Yogurt 2. This demonstrates the importance of pricing strategies in competitive markets and highlights the value of using such models for predictive analytics in marketing and pricing decisions.\n\n\n## 2. Estimating Minivan Preferences\n\n\n### Data\n\n_todo: download the dataset from here:_ http://goo.gl/5xQObB \n\n::: {#050b191d .cell message='true' execution_count=14}\n\n::: {.cell-output .cell-output-display execution_count=14}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>resp.id</th>\n      <th>ques</th>\n      <th>alt</th>\n      <th>carpool</th>\n      <th>seat</th>\n      <th>cargo</th>\n      <th>eng</th>\n      <th>price</th>\n      <th>choice</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>1</td>\n      <td>1</td>\n      <td>1</td>\n      <td>yes</td>\n      <td>6</td>\n      <td>2ft</td>\n      <td>gas</td>\n      <td>35</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>1</td>\n      <td>1</td>\n      <td>2</td>\n      <td>yes</td>\n      <td>8</td>\n      <td>3ft</td>\n      <td>hyb</td>\n      <td>30</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>1</td>\n      <td>1</td>\n      <td>3</td>\n      <td>yes</td>\n      <td>6</td>\n      <td>3ft</td>\n      <td>gas</td>\n      <td>30</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>1</td>\n      <td>2</td>\n      <td>1</td>\n      <td>yes</td>\n      <td>6</td>\n      <td>2ft</td>\n      <td>gas</td>\n      <td>30</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>1</td>\n      <td>2</td>\n      <td>2</td>\n      <td>yes</td>\n      <td>7</td>\n      <td>3ft</td>\n      <td>gas</td>\n      <td>35</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>8995</th>\n      <td>200</td>\n      <td>14</td>\n      <td>2</td>\n      <td>no</td>\n      <td>7</td>\n      <td>3ft</td>\n      <td>gas</td>\n      <td>35</td>\n      <td>1</td>\n    </tr>\n    <tr>\n      <th>8996</th>\n      <td>200</td>\n      <td>14</td>\n      <td>3</td>\n      <td>no</td>\n      <td>7</td>\n      <td>3ft</td>\n      <td>hyb</td>\n      <td>35</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>8997</th>\n      <td>200</td>\n      <td>15</td>\n      <td>1</td>\n      <td>no</td>\n      <td>7</td>\n      <td>2ft</td>\n      <td>gas</td>\n      <td>35</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>8998</th>\n      <td>200</td>\n      <td>15</td>\n      <td>2</td>\n      <td>no</td>\n      <td>8</td>\n      <td>3ft</td>\n      <td>elec</td>\n      <td>40</td>\n      <td>0</td>\n    </tr>\n    <tr>\n      <th>8999</th>\n      <td>200</td>\n      <td>15</td>\n      <td>3</td>\n      <td>no</td>\n      <td>6</td>\n      <td>3ft</td>\n      <td>gas</td>\n      <td>35</td>\n      <td>1</td>\n    </tr>\n  </tbody>\n</table>\n<p>9000 rows Ã— 9 columns</p>\n</div>\n```\n:::\n:::\n\n\nThe dataset `rintro-chapter13conjoint.csv` appears to contain data from a conjoint analysis, typically used to gauge consumer preferences across different product features. Here's a breakdown of the columns:\n\n*   `resp.id`: Identifier for respondents.\n*   `ques`: Question or scenario number.\n*   `alt`: Alternative options presented within each question.\n*   `carpool`: Indicates if the option includes a carpool feature (yes/no).\n*   `seat`: Number of seats.\n*   `cargo`: Cargo space.\n*   `eng`: Type of engine (e.g., 'gas' for gasoline, 'hyb' for hybrid).\n*   `price`: Price in thousands of dollars.\n*   `choice`: Binary indicator of whether the respondent chose this alternative (1 for chosen, 0 for not chosen).\n\n\n_todo: describe the data a bit. How many respondents took the conjoint survey?  How many choice tasks did each respondent complete?  How many alternatives were presented on each choice task? For each alternative._\n\n\n\n::: {#0b282d82 .cell message='true' execution_count=16}\n``` {.python .cell-code}\nnum_respondents, tasks_per_respondent.describe(), alternatives_per_task\n```\n\n::: {.cell-output .cell-output-display execution_count=16}\n```\n(200,\n count    200.0\n mean      15.0\n std        0.0\n min       15.0\n 25%       15.0\n 50%       15.0\n 75%       15.0\n max       15.0\n Name: ques, dtype: float64,\n 3)\n```\n:::\n:::\n\n\nHere's a summary of the dataset based on the analysis:\n\n1.  **Number of Respondents**: There are 200 unique respondents who participated in the conjoint survey.\n    \n2.  **Choice Tasks Per Respondent**:\n    \n    *   Each respondent completed 15 choice tasks.\n    *   This is consistent across all respondents, as indicated by the lack of variability (standard deviation is 0).\n3.  **Alternatives Presented in Each Choice Task**:\n    \n    *   Each choice task presented 3 alternatives to the respondents.\n    *   This number is consistent across all tasks and respondents, as shown by the uniform count and lack of variability.\n\n\nThe attributes (levels) were number of seats (6,7,8), cargo space (2ft, 3ft), engine type (gas, hybrid, electric), and price (in thousands of dollars).\n\n\n### Model\n\n_todo: estimate a MNL model omitting the following levels to avoide multicollinearity (6 seats, 2ft cargo, and gas engine). Include price as a continuous variable. Show a table of coefficients and standard errors.  You may use your own likelihood function from above, or you may use a function from a package/library to perform the estimation._  \n\n\n\n::: {#113d60bf .cell message='true' execution_count=18}\n``` {.python .cell-code}\n# Adding a constant to the model (intercept)\nX = sm.add_constant(X)\n\n# Check if there are still any object types\nprint(X.dtypes, y.dtypes)\n\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nconst        float64\ncarpool        int64\nprice          int64\nseat_7         int64\nseat_8         int64\ncargo_3ft      int64\neng_hyb        int64\ndtype: object int64\n```\n:::\n:::\n\n\n::: {#2e9133dc .cell message='true' execution_count=19}\n``` {.python .cell-code}\n# Fit the MNL model\nmnl_model = sm.MNLogit(y, X)\nmnl_result = mnl_model.fit()\n\n# Print the summary of the model\nprint(mnl_result.summary())\n```\n\n::: {.cell-output .cell-output-stdout}\n```\nOptimization terminated successfully.\n         Current function value: 0.591150\n         Iterations 5\n                          MNLogit Regression Results                          \n==============================================================================\nDep. Variable:                 choice   No. Observations:                 9000\nModel:                        MNLogit   Df Residuals:                     8993\nMethod:                           MLE   Df Model:                            6\nDate:                Sun, 12 May 2024   Pseudo R-squ.:                 0.07127\nTime:                        21:54:45   Log-Likelihood:                -5320.3\nconverged:                       True   LL-Null:                       -5728.6\nCovariance Type:            nonrobust   LLR p-value:                4.060e-173\n==============================================================================\n  choice=1       coef    std err          z      P>|z|      [0.025      0.975]\n------------------------------------------------------------------------------\nconst          4.5121      0.210     21.490      0.000       4.101       4.924\ncarpool        0.0074      0.051      0.144      0.885      -0.093       0.108\nprice         -0.1486      0.006    -24.977      0.000      -0.160      -0.137\nseat_7        -0.4832      0.058     -8.397      0.000      -0.596      -0.370\nseat_8        -0.2645      0.056     -4.687      0.000      -0.375      -0.154\ncargo_3ft      0.4099      0.047      8.723      0.000       0.318       0.502\neng_hyb       -0.1102      0.050     -2.203      0.028      -0.208      -0.012\n==============================================================================\n```\n:::\n:::\n\n\n### Results\n\n_todo: Interpret the coefficients. Which features are more preferred?_\n\n*   **Price**: The negative coefficient for price (âˆ’0.1486) indicates that as the price increases, the likelihood of choosing that option decreases, as expected.\n*   **Seat 7 and Seat 8**: Both coefficients are negative, indicating less preference compared to the baseline (6 seats). The magnitude of the coefficient for Seat 7 is larger, suggesting a stronger negative preference compared to Seat 8.\n*   **Cargo 3**: The positive coefficient (0.4099) suggests a preference for more cargo space (3ft) over the baseline (2ft).\n*   **Eng Hyb**: The slight negative coefficient for the hybrid engine (âˆ’0.1102) suggests a slight aversion compared to the gasoline engine, although this effect is relatively small.\n\nThese coefficients provide insights into the preferences of respondents regarding different features of the products presented in the conjoint study. The standard errors indicate the precision of these estimates, with all p-values being significant, showing strong evidence against the null hypothesis of no effect.\n\n\n_todo: Use the price coefficient as a dollar-per-util conversion factor. What is the dollar value of 3ft of cargo space as compared to 2ft of cargo space?_\n\n::: {#60486e4c .cell message='true' execution_count=20}\n``` {.python .cell-code}\n# Coefficients from the model\ncargo_3ft_coeff = mnl_result.params.loc['cargo_3ft'][0]\nprice_coeff = mnl_result.params.loc['price'][0]\n\n# Calculate the dollar value of 3ft of cargo space compared to 2ft\ndollar_value_cargo_3ft = cargo_3ft_coeff / -price_coeff\ndollar_value_cargo_3ft\n```\n\n::: {.cell-output .cell-output-display execution_count=20}\n```\n2.7589563979556146\n```\n:::\n:::\n\n\nThe dollar value of having 3ft of cargo space as compared to 2ft, based on the estimated model coefficients, is approximately **$2.76**.\n\nThis means that, according to the model, consumers would be willing to pay an additional $2.76 for a vehicle option that offers 3ft of cargo space over one that offers only 2ft, all else being equal. This calculation converts the utility gained from larger cargo space into a monetary equivalent using the sensitivity of consumer choices to changes in price.\n\n\n_todo: assume the market consists of the following 6 minivans. Predict the market shares of each minivan in the market._\n\n| Minivan | Seats | Cargo | Engine | Price |\n|---------|-------|-------|--------|-------|\n| A       | 7     | 2     | Hyb    | 30    |\n| B       | 6     | 2     | Gas    | 30    |\n| C       | 8     | 2     | Gas    | 30    |\n| D       | 7     | 3     | Gas    | 40    |\n| E       | 6     | 2     | Elec   | 40    |\n| F       | 7     | 2     | Hyb    | 35    |\n\n\n\n::: {#59c1d67e .cell message='true' execution_count=22}\n``` {.python .cell-code}\n# Calculate utilities for each minivan\nutilities = np.dot(X_minivans, mnl_result.params.values)\n# Compute market shares using softmax function\nmarket_shares = np.exp(utilities) / np.sum(np.exp(utilities), axis=0)\n\n# Add market shares to the minivans dataframe\nminivans['Market Share'] = market_shares\nminivans[['Minivan', 'Market Share']]\n```\n\n::: {.cell-output .cell-output-display execution_count=22}\n```{=html}\n<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Minivan</th>\n      <th>Market Share</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>A</td>\n      <td>0.204170</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>B</td>\n      <td>0.264023</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>C</td>\n      <td>0.227573</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>D</td>\n      <td>0.054479</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>E</td>\n      <td>0.132099</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>F</td>\n      <td>0.117656</td>\n    </tr>\n  </tbody>\n</table>\n</div>\n```\n:::\n:::\n\n\n### Market Share Interpretation\n\n1.  **Minivan B (26.40%)**:\n    \n    *   **Attributes**: 6 seats, 2ft cargo, Gas engine, priced at $30.\n    *   **Interpretation**: This option has the highest market share, which suggests that a lower price combined with the base features (6 seats, Gas engine) is highly attractive to consumers. The absence of additional features seems to be offset by the lower price.\n2.  **Minivan C (22.76%)**:\n    \n    *   **Attributes**: 8 seats, 2ft cargo, Gas engine, also priced at $30.\n    *   **Interpretation**: The second most popular option, indicating a strong preference for more seating capacity at no additional cost in price, suggesting that consumers value additional seating when all other factors are equal.\n3.  **Minivan A (20.42%)**:\n    \n    *   **Attributes**: 7 seats, 2ft cargo, Hybrid engine, priced at $30.\n    *   **Interpretation**: The presence of a Hybrid engine with moderate pricing and seat count shows significant consumer interest in more environmentally friendly options when they are not priced higher than gas models.\n4.  **Minivan E (13.21%)**:\n    \n    *   **Attributes**: 6 seats, 2ft cargo, Electric engine, priced at $40.\n    *   **Interpretation**: Indicates a moderate interest in electric vehicles, though the higher price seems to be a deterrent compared to cheaper gas options.\n5.  **Minivan F (11.77%)**:\n    \n    *   **Attributes**: 7 seats, 2ft cargo, Hybrid engine, priced at $35.\n    *   **Interpretation**: Similar to Minivan A but slightly more expensive, which slightly reduces its attractiveness despite the hybrid engine.\n6.  **Minivan D (5.45%)**:\n    \n    *   **Attributes**: 7 seats, 3ft cargo, Gas engine, priced at $40.\n    *   **Interpretation**: Despite offering more cargo space, its higher price significantly lowers its market share. This suggests that price sensitivity may outweigh the benefit of additional cargo space for many consumers.\n\n### Overall Insights\n\n*   **Price Sensitivity**: Price plays a crucial role in consumer choices, as seen by the higher market shares of the lower-priced models.\n*   **Preference for Seat Capacity**: There is a clear preference for higher seating capacity when the price is held constant.\n*   **Eco-friendly Options**: Consumers show interest in hybrid and electric vehicles, but their choices are sensitive to price differences.\n*   **Cargo Space Value**: Additional cargo space does not seem to drive higher market share, especially when accompanied by a higher price.\n\nThese insights could be used to strategize product offerings, pricing decisions, and marketing campaigns by highlighting features that align with consumer preferences.\n\n\n_hint: this example is taken from the \"R 4 Marketing Research\" book by Chapman and Feit. I believe the same example is present in the companion book titled \"Python 4 Marketing Research\".  I encourage you to attempt these questions on your own, but if you get stuck or would like to compare you results to \"the answers,\" you may consult the Chapman and Feit books._\n\n",
    "supporting": [
      "hw3_questions_files"
    ],
    "filters": [],
    "includes": {
      "include-in-header": [
        "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\" integrity=\"sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==\" crossorigin=\"anonymous\"></script>\n<script src=\"https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js\" integrity=\"sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==\" crossorigin=\"anonymous\" data-relocate-top=\"true\"></script>\n<script type=\"application/javascript\">define('jquery', [],function() {return window.jQuery;})</script>\n"
      ]
    }
  }
}